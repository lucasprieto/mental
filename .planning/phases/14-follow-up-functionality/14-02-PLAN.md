---
phase: 14-follow-up-functionality
plan: 02
type: execute
depends_on: ["14-01"]
files_modified: [packages/mcp-server/src/index.ts, packages/mcp-server/src/api.ts, packages/webapp/src/app/item/[id]/page.tsx]
---

<objective>
Add MCP tool and webapp UI for follow-ups.

Purpose: Enable users to add follow-ups via Claude Code/Cursor and view them in the webapp.
Output: Working `add_followup` MCP tool and follow-ups displayed on item detail page.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/14-follow-up-functionality/14-01-SUMMARY.md

**Key source files:**
@packages/mcp-server/src/index.ts
@packages/mcp-server/src/api.ts
@packages/webapp/src/app/item/[id]/page.tsx

**From Plan 01:**
- follow_ups table exists
- API routes at /followups (POST /, GET /item/:itemId)
- Types in @mental/shared
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add MCP add_followup tool</name>
  <files>packages/mcp-server/src/api.ts, packages/mcp-server/src/index.ts</files>
  <action>
1. Add follow-ups API client to packages/mcp-server/src/api.ts:
   - Import FollowupsRoute type from @mental/api
   - Create getFollowupsClient() following same pattern as getItemsClient()

2. Add `add_followup` tool to packages/mcp-server/src/index.ts:
   - Parameters: id (string, thought ID), content (string, follow-up text)
   - Description: "Add a follow-up update to an existing thought. Use when you have additional context, progress, or notes to append to a captured thought."
   - Verify item exists via GET /items/:id first (404 handling)
   - POST to /followups with { itemId: id, content }
   - Return confirmation with follow-up ID and timestamp

3. Example tool:
```typescript
server.tool(
  "add_followup",
  "Add a follow-up update to an existing thought. Use when you have additional context, progress, or notes to append to a captured thought.",
  {
    id: z.string().describe("The thought ID to add follow-up to"),
    content: z.string().describe("The follow-up content (progress update, additional context, notes)")
  },
  async ({ id, content }) => {
    console.error(`[mental-mcp] Adding follow-up to: ${id}`);

    const itemsClient = getItemsClient();
    const followupsClient = getFollowupsClient();

    // Check item exists
    const getRes = await itemsClient[":id"].$get({ param: { id } });
    if (getRes.status === 404) {
      return {
        content: [{ type: "text", text: `Thought not found: ${id}` }]
      };
    }

    const item = await getRes.json();

    // Create follow-up
    const res = await followupsClient.index.$post({
      json: { itemId: id, content }
    });

    if (!res.ok) {
      return {
        content: [{ type: "text", text: `Error adding follow-up: ${res.status}` }]
      };
    }

    const followup = await res.json();

    return {
      content: [{
        type: "text",
        text: `Follow-up added to: "${item.title}"\nFollow-up ID: ${followup.id}\nCreated: ${followup.createdAt}`
      }]
    };
  }
);
```
  </action>
  <verify>pnpm --filter @mental/mcp-server build succeeds. Test add_followup tool via MCP inspector or direct usage.</verify>
  <done>add_followup MCP tool working, creates follow-ups linked to items.</done>
</task>

<task type="auto">
  <name>Task 2: Display follow-ups in webapp item detail</name>
  <files>packages/webapp/src/app/item/[id]/page.tsx, packages/webapp/src/lib/api.ts</files>
  <action>
1. Add follow-ups client to packages/webapp/src/lib/api.ts:
   - Import FollowupsRoute type from @mental/api
   - Create getFollowupsClient() following same pattern

2. Update packages/webapp/src/app/item/[id]/page.tsx:
   - Fetch follow-ups for the item using GET /followups/item/:id
   - Display follow-ups in a "Follow-ups" section below the main content
   - Show each follow-up with timestamp and content
   - If no follow-ups, show subtle "No follow-ups yet" message
   - Style consistently with existing Linear-style aesthetic

3. Follow-ups section design:
```tsx
{/* Follow-ups section */}
<section className="mt-8">
  <h2 className="text-lg font-semibold text-gray-800 mb-4">
    Follow-ups
    <span className="ml-2 text-sm font-normal text-gray-500">
      ({followups.length})
    </span>
  </h2>
  {followups.length === 0 ? (
    <p className="text-gray-500 text-sm italic">No follow-ups yet</p>
  ) : (
    <div className="space-y-4">
      {followups.map((followup) => (
        <div key={followup.id} className="bg-white rounded-lg shadow p-4">
          <p className="text-gray-400 text-xs mb-2">
            {new Date(followup.createdAt).toLocaleDateString()}
          </p>
          <p className="text-gray-700">{followup.content}</p>
        </div>
      ))}
    </div>
  )}
</section>
```
  </action>
  <verify>pnpm --filter @mental/webapp build succeeds. Visit item detail page in browser, verify follow-ups display correctly.</verify>
  <done>Follow-ups displayed on item detail page with clean styling.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Follow-up functionality: MCP tool and webapp display</what-built>
  <how-to-verify>
    1. Start API: pnpm --filter @mental/api dev
    2. Start webapp: pnpm --filter @mental/webapp dev
    3. Use MCP add_followup tool to add follow-up to an existing item
    4. Visit http://localhost:3001/item/:id to see the item
    5. Verify follow-ups section appears with the added follow-up
    6. Add another follow-up, refresh page, verify both appear in order
  </how-to-verify>
  <resume-signal>Type "approved" to complete phase, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `pnpm --filter @mental/mcp-server build` succeeds
- [ ] `pnpm --filter @mental/webapp build` succeeds
- [ ] add_followup MCP tool creates follow-ups
- [ ] Follow-ups display on item detail page
- [ ] Human verification approved
</verification>

<success_criteria>
- add_followup MCP tool working
- Webapp displays follow-ups with timestamps
- Clean, consistent styling
- Phase 14 complete
</success_criteria>

<output>
After completion, create `.planning/phases/14-follow-up-functionality/14-02-SUMMARY.md`
</output>
