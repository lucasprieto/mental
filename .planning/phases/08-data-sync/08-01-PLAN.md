---
phase: 08-data-sync
plan: 01
type: execute
depends_on: []
files_modified: [packages/api/drizzle.config.ts, packages/api/.env.local]
---

<objective>
Set up Neon Postgres database and apply the schema.

Purpose: Create the hosted database that will replace local SQLite for multi-computer access.
Output: Neon database with mental_items table, drizzle config for schema management.
</objective>

<execution_context>
./.claude/get-shit-done/workflows/execute-plan.md
./.claude/get-shit-done/templates/summary.md
./.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-data-sync/08-RESEARCH.md
@.planning/phases/07-backend-setup/07-01-SUMMARY.md
@.planning/phases/07-backend-setup/07-02-SUMMARY.md
@packages/db/src/schema-pg.ts
@packages/api/package.json

**Tech stack available:** Hono, @neondatabase/serverless, drizzle-orm, drizzle-kit
**Established patterns:** Dual schema (SQLite for local, Postgres for hosted), lazy db initialization
**Constraining decisions:**
- Phase 7: Postgres schema uses timestamp with mode: date
- Phase 7: All drizzle imports through @mental/db to avoid version conflicts
</context>

<tasks>

<task type="checkpoint:human-action" gate="blocking">
  <action>Create Neon database and provide connection string</action>
  <instructions>
    I need you to create a Neon database:

    1. Go to https://neon.tech
    2. Sign up or log in (GitHub OAuth is fastest)
    3. Create a new project named "mental"
    4. On the dashboard, copy the **pooled connection string** (looks like: postgresql://user:pass@ep-xxx-pooler.region.aws.neon.tech/neondb?sslmode=require)

    Paste the connection string when done.
  </instructions>
  <verification>Connection string starts with postgresql:// and contains "pooler" in the hostname</verification>
  <resume-signal>Paste the DATABASE_URL connection string</resume-signal>
</task>

<task type="auto">
  <name>Task 1: Create drizzle config and .env.local with connection string</name>
  <files>packages/api/drizzle.config.ts, packages/api/.env.local</files>
  <action>
    Create drizzle.config.ts in packages/api that:
    - Points to ../db/src/schema-pg.ts for schema
    - Uses postgresql dialect
    - Reads DATABASE_URL from process.env
    - Outputs migrations to ./drizzle directory

    Create .env.local with the DATABASE_URL provided by the user.

    Add .env.local to .gitignore if not already present.
  </action>
  <verify>cat packages/api/drizzle.config.ts shows valid config, .env.local exists with DATABASE_URL</verify>
  <done>Drizzle config created, .env.local has connection string, .gitignore updated</done>
</task>

<task type="auto">
  <name>Task 2: Push schema to Neon and verify tables exist</name>
  <files>packages/api/package.json</files>
  <action>
    Add drizzle-kit as a devDependency to packages/api if not present.

    Add script to package.json: "db:push": "drizzle-kit push"

    Run `pnpm --filter @mental/api db:push` to create the mental_items table in Neon.

    Verify by starting the API and hitting the health endpoint.
  </action>
  <verify>drizzle-kit push succeeds, API starts without database errors, curl localhost:3000/health returns 200</verify>
  <done>mental_items table exists in Neon, API connects successfully</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] drizzle.config.ts exists in packages/api
- [ ] .env.local has valid DATABASE_URL
- [ ] `pnpm --filter @mental/api db:push` runs without errors
- [ ] API starts and health endpoint responds
</verification>

<success_criteria>

- Neon database created with mental_items table
- Drizzle config properly configured
- API can connect to Neon database
- Ready for data migration in 08-02
</success_criteria>

<output>
After completion, create `.planning/phases/08-data-sync/08-01-SUMMARY.md`
</output>
