---
phase: 11-advanced-capture
plan: 01
type: execute
depends_on: []
files_modified: [packages/mcp-server/src/index.ts]
---

<objective>
Add sentiment/urgency detection to theme extraction for automatic classification of thoughts.

Purpose: Enable automatic detection of blockers, concerns, ideas, and questions from content, making it easier to prioritize and filter captured thoughts.
Output: Enhanced extractTheme() function that detects sentiment patterns alongside topic extraction.
</objective>

<execution_context>
./.claude/get-shit-done/workflows/execute-plan.md
./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/11-advanced-capture/CONTEXT.md
@packages/mcp-server/src/index.ts

**Tech stack available:** Hono RPC client, MCP SDK v1.x, zod validation
**Established patterns:** extractTheme() for topic detection, console.error for logging

**Requirements from CONTEXT.md:**
- Detect sentiment/urgency: blocker, concern, idea, question
- Apply as themes automatically
- Map to auto-tags (handled in Plan 02)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add sentiment detection function</name>
  <files>packages/mcp-server/src/index.ts</files>
  <action>
Create a new `detectSentiment()` function above extractTheme() that analyzes content for sentiment patterns.

Patterns to detect:
- **blocker**: "blocked", "can't proceed", "waiting on", "waiting for", "dependency", "depends on", "stuck"
- **concern**: "worried", "risk", "might break", "unsure", "uncertain", "problem", "issue"
- **idea**: "could", "maybe", "what if", "might be better", "suggestion", "consider", "alternative"
- **question**: ends with "?", "how do", "why does", "not sure if", "wondering", "unclear"

Function signature:
```typescript
function detectSentiment(content: string): "blocker" | "concern" | "idea" | "question" | null
```

Priority order (first match wins): blocker > concern > question > idea

Use case-insensitive matching. Check for "?" anywhere in content for question detection (not just end).
  </action>
  <verify>Function exists and can be called with test content</verify>
  <done>detectSentiment() function implemented with all four sentiment patterns</done>
</task>

<task type="auto">
  <name>Task 2: Integrate sentiment into theme extraction</name>
  <files>packages/mcp-server/src/index.ts</files>
  <action>
Update the capture_thought tool to use sentiment detection:

1. Call `detectSentiment(content)` before `extractTheme(content)`
2. If sentiment is detected, use it as the theme (override topic extraction)
3. Log detected sentiment: `console.error(\`[mental-mcp] Sentiment detected: ${sentiment}\`)`
4. If no sentiment detected, fall back to existing extractTheme() behavior

This makes sentiment the primary theme when detected, with topic extraction as fallback.

Update the response text to show sentiment if detected:
```
Theme: ${sentiment || theme || "none"} ${sentiment ? "(sentiment)" : ""}
```
  </action>
  <verify>Run MCP server and test capture_thought with "I'm blocked on the API" - should show theme: blocker</verify>
  <done>Sentiment detection integrated, blocker/concern/idea/question detected and used as theme</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `pnpm build` succeeds in packages/mcp-server
- [ ] detectSentiment() returns correct values for test cases:
  - "blocked on API" → blocker
  - "worried about performance" → concern
  - "what if we used Redis?" → idea
  - "how do I configure this?" → question
  - "need to update the config" → null (falls back to topic)
</verification>

<success_criteria>

- detectSentiment() function implemented
- Sentiment used as theme when detected
- Falls back to topic extraction when no sentiment
- Build passes
</success_criteria>

<output>
After completion, create `.planning/phases/11-advanced-capture/11-01-SUMMARY.md`
</output>
