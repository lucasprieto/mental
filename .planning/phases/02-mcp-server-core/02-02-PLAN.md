---
phase: 02-mcp-server-core
plan: 02
type: execute
depends_on: ["02-01"]
files_modified: [packages/mcp-server/src/index.ts, .mcp.json]
---

<objective>
Add capture_thought tool stub and configure Claude Code integration.

Purpose: Complete Phase 2 by adding a real tool and setting up client discovery.
Output: MCP server with capture tool (stub), example config for Claude Code/Cursor.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/02-mcp-server-core/02-RESEARCH.md
@.planning/phases/02-mcp-server-core/02-01-SUMMARY.md

**From 02-01:**
- @mental/mcp-server package created
- Basic server with ping tool working
- MCP Inspector verified connection

**From RESEARCH.md - Tool patterns:**
```typescript
server.tool(
  "tool_name",
  "Description for LLM",
  { param: z.string().describe("Parameter description") },
  async ({ param }) => {
    return { content: [{ type: "text", text: "Result" }] };
  }
);
```

**From RESEARCH.md - Configuration:**
- Claude Code: .mcp.json in project root
- Cursor: .cursor/mcp.json in project root
- MUST use absolute paths (working directory is undefined)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add capture_thought tool (stub)</name>
  <files>packages/mcp-server/src/index.ts</files>
  <action>
Add a capture_thought tool to the server. This is a STUB - it won't actually save to database yet (that's Phase 3). It should:

1. Accept parameters matching CreateMentalItemInput from @mental/shared:
   - title: string (required) - Brief title
   - content: string (required) - Full content
   - tags: string[] (optional) - Tags for categorization

2. Log the capture to stderr
3. Return confirmation text

```typescript
server.tool(
  "capture_thought",
  "Capture a thought or topic to your mental database. Use this when the user mentions something they want to remember, track, or come back to later.",
  {
    title: z.string().describe("Brief title for the thought (2-10 words)"),
    content: z.string().describe("Full content or context of the thought"),
    tags: z.array(z.string()).optional().describe("Optional tags for categorization")
  },
  async ({ title, content, tags }) => {
    console.error(`[mental-mcp] Capturing thought: "${title}"`);
    console.error(`[mental-mcp] Content: ${content.substring(0, 100)}...`);
    console.error(`[mental-mcp] Tags: ${tags?.join(", ") || "none"}`);

    // TODO: Phase 3 will add actual database persistence

    return {
      content: [{
        type: "text",
        text: `Captured thought: "${title}"\n\nThis thought has been logged. (Note: Database persistence coming in Phase 3)`
      }]
    };
  }
);
```

CRITICAL: Tool description matters - it tells the LLM when to use this tool. Make it clear and actionable.
  </action>
  <verify>pnpm --filter @mental/mcp-server build succeeds; MCP Inspector shows capture_thought tool with correct parameters</verify>
  <done>capture_thought tool registered with proper Zod schema and descriptive help text</done>
</task>

<task type="auto">
  <name>Task 2: Create example .mcp.json config</name>
  <files>.mcp.json.example, .cursor/mcp.json.example</files>
  <action>
Create example configuration files for Claude Code and Cursor. These are EXAMPLES (not the actual config) because:
1. Paths must be absolute and user-specific
2. Users need to copy and customize

1. Create .mcp.json.example for Claude Code:
```json
{
  "mcpServers": {
    "mental": {
      "command": "node",
      "args": ["/ABSOLUTE/PATH/TO/mental/packages/mcp-server/dist/index.js"],
      "env": {}
    }
  }
}
```

2. Create .cursor/mcp.json.example for Cursor:
```json
{
  "mcpServers": {
    "mental": {
      "command": "node",
      "args": ["/ABSOLUTE/PATH/TO/mental/packages/mcp-server/dist/index.js"]
    }
  }
}
```

3. Add comments in a README section or inline explaining:
   - Replace /ABSOLUTE/PATH/TO with actual path
   - Copy to .mcp.json (Claude Code) or .cursor/mcp.json (Cursor)
   - Must rebuild after changes: pnpm --filter @mental/mcp-server build

CRITICAL from research: Absolute paths are mandatory. Relative paths fail because MCP server working directory is undefined.
  </action>
  <verify>ls -la shows .mcp.json.example and .cursor/mcp.json.example exist</verify>
  <done>Example configs created with clear instructions for customization</done>
</task>

<task type="auto">
  <name>Task 3: Verify full integration</name>
  <files>packages/mcp-server/src/index.ts</files>
  <action>
Final verification steps:

1. Build the server: pnpm --filter @mental/mcp-server build

2. Test with MCP Inspector:
   - Run: pnpm --filter @mental/mcp-server inspect
   - Verify both tools appear: ping, capture_thought
   - Call capture_thought with test data:
     - title: "Test thought"
     - content: "This is a test capture"
     - tags: ["test", "verification"]
   - Confirm response shows captured thought

3. Verify no console.log statements exist:
   - grep -r "console.log" packages/mcp-server/src/ should return nothing

4. Verify package exports are clean:
   - Check package.json has correct main entry
   - Verify dist/index.js is the only entry point needed
  </action>
  <verify>MCP Inspector shows both tools; capture_thought returns expected response; no console.log in source</verify>
  <done>Full MCP server verified: ping + capture_thought tools working, ready for Phase 3 database integration</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] pnpm -r build succeeds
- [ ] MCP Inspector shows ping and capture_thought tools
- [ ] capture_thought accepts title, content, tags and returns confirmation
- [ ] No console.log statements in mcp-server source
- [ ] Example config files created with clear documentation
- [ ] grep "console.log" returns nothing
</verification>

<success_criteria>
- capture_thought tool registered with correct schema
- Tool descriptions are clear for LLM usage
- Example configs created for Claude Code and Cursor
- Server verified working with both tools via Inspector
- Phase 2 complete - MCP server ready for database integration (Phase 3)
</success_criteria>

<output>
After completion, create `.planning/phases/02-mcp-server-core/02-02-SUMMARY.md`
</output>
