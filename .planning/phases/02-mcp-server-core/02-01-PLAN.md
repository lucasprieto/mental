---
phase: 02-mcp-server-core
plan: 01
type: execute
depends_on: []
files_modified: [packages/mcp-server/package.json, packages/mcp-server/tsconfig.json, packages/mcp-server/src/index.ts]
---

<objective>
Create the @mental/mcp-server package with basic MCP server that connects via stdio transport.

Purpose: Establish the MCP server foundation that Claude Code/Cursor can connect to.
Output: Working MCP server package with a simple ping tool, testable via MCP Inspector.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/02-mcp-server-core/02-RESEARCH.md

**Tech stack from Phase 1:**
- pnpm monorepo with workspace packages
- TypeScript with NodeNext resolution
- @mental/shared (MentalItem types)
- @mental/db (Drizzle schema, getDb)

**From RESEARCH.md - Critical patterns:**
- Use @modelcontextprotocol/sdk v1.x (v2 is pre-alpha)
- StdioServerTransport for local MCP servers
- NEVER use console.log - it corrupts stdio protocol (use console.error)
- Tool definitions use Zod schemas with server.tool()

**From RESEARCH.md - Don't hand-roll:**
- Protocol handling → use SDK
- Transport layer → use StdioServerTransport
- Schema validation → use Zod
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create mcp-server package</name>
  <files>packages/mcp-server/package.json, packages/mcp-server/tsconfig.json</files>
  <action>
Create @mental/mcp-server package in packages/mcp-server/:

1. package.json with:
   - name: "@mental/mcp-server"
   - type: "module"
   - main: "dist/index.js"
   - scripts: { "build": "tsc", "start": "node dist/index.js" }
   - dependencies: @modelcontextprotocol/sdk, zod
   - devDependencies: @types/node, typescript

2. tsconfig.json extending root config:
   - extends: "../../tsconfig.json"
   - compilerOptions: { outDir: "dist", rootDir: "src" }
   - include: ["src"]

3. Run pnpm install from root to link dependencies

CRITICAL from research: Use SDK v1.x (^1.0.0), not v2 which is pre-alpha.
  </action>
  <verify>pnpm -r build succeeds with no errors for mcp-server package</verify>
  <done>Package created, dependencies installed, tsconfig valid</done>
</task>

<task type="auto">
  <name>Task 2: Implement basic MCP server with ping tool</name>
  <files>packages/mcp-server/src/index.ts</files>
  <action>
Create src/index.ts with minimal MCP server:

```typescript
import { McpServer } from "@modelcontextprotocol/sdk/server/mcp.js";
import { StdioServerTransport } from "@modelcontextprotocol/sdk/server/stdio.js";
import { z } from "zod";

const server = new McpServer({
  name: "mental-mcp",
  version: "1.0.0"
});

// Simple ping tool to verify connectivity
server.tool(
  "ping",
  "Health check - returns pong to verify server is running",
  {},
  async () => {
    console.error("[mental-mcp] Ping received");
    return {
      content: [{ type: "text", text: "pong" }]
    };
  }
);

// Connect to stdio transport
const transport = new StdioServerTransport();
await server.connect(transport);

console.error("[mental-mcp] Server started");
```

CRITICAL from research:
- Use console.error for ALL logging (never console.log - corrupts stdio)
- Import from specific paths (@modelcontextprotocol/sdk/server/mcp.js)
- Empty object {} for tool with no parameters
  </action>
  <verify>pnpm --filter @mental/mcp-server build succeeds; node packages/mcp-server/dist/index.js starts without crashing (use ctrl+c to exit)</verify>
  <done>Server starts, ping tool registered, uses stderr for logging</done>
</task>

<task type="auto">
  <name>Task 3: Test with MCP Inspector</name>
  <files>packages/mcp-server/package.json</files>
  <action>
1. Add @modelcontextprotocol/inspector as devDependency
2. Add script: "inspect": "npx @modelcontextprotocol/inspector node dist/index.js"
3. Build and run: pnpm --filter @mental/mcp-server build && pnpm --filter @mental/mcp-server inspect
4. In the inspector web UI (opens at localhost:5173):
   - Verify server connects
   - Call "ping" tool
   - Confirm "pong" response

Note: Inspector runs the server as a subprocess, so we can test the full stdio flow.
  </action>
  <verify>MCP Inspector shows server connected, ping tool returns "pong"</verify>
  <done>Server verified working via MCP Inspector, ping tool responds correctly</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] pnpm -r build succeeds (all packages including mcp-server)
- [ ] packages/mcp-server/dist/index.js exists
- [ ] Server starts without errors (manual test)
- [ ] MCP Inspector can connect and call ping tool
</verification>

<success_criteria>
- @mental/mcp-server package created with correct structure
- MCP server starts and connects via stdio transport
- Ping tool registered and responds to calls
- No console.log statements (only console.error)
- MCP Inspector verification passed
</success_criteria>

<output>
After completion, create `.planning/phases/02-mcp-server-core/02-01-SUMMARY.md`
</output>
