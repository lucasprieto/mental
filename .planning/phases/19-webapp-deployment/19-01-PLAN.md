---
phase: 19-webapp-deployment
plan: 01
type: execute
depends_on: []
files_modified: [packages/webapp/next.config.ts, packages/webapp/.env.local.example, vercel.json]
---

<objective>
Deploy the Mental webapp to Vercel with Auth0 authentication working in production.

Purpose: Make the webapp publicly accessible with proper authentication so users can view and manage their captured thoughts from any device.
Output: Live webapp deployed on Vercel with Auth0 login protecting all routes.
</objective>

<execution_context>
./.claude/get-shit-done/workflows/execute-plan.md
./.claude/get-shit-done/templates/summary.md
./.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/18-auth0-integration/18-02-SUMMARY.md

@packages/webapp/package.json
@packages/webapp/src/middleware.ts
@packages/webapp/src/lib/auth0.ts
@packages/webapp/.env.local.example

**Current state:**
- Webapp runs locally on port 3001
- Auth0 integration complete (login, logout, route protection)
- Uses @mental/api workspace dependency for API client
- API is hosted at api.gomental.dev (Fly.io)

**Auth0 configuration needed for production:**
- Allowed Callback URLs: https://{vercel-domain}/auth/callback
- Allowed Logout URLs: https://{vercel-domain}
- APP_BASE_URL must be set to production domain
</context>

<tasks>

<task type="auto">
  <name>Task 1: Configure Next.js for Vercel deployment</name>
  <files>packages/webapp/next.config.ts, packages/webapp/.env.local.example</files>
  <action>
1. Check/update next.config.ts for Vercel compatibility:
   - Ensure output is not set to 'standalone' (Vercel handles this)
   - No changes needed if using default settings

2. Update .env.local.example with production guidance:
   - Add comments explaining production vs local values
   - Note that AUTH0_BASE_URL must match Vercel deployment URL
   - Document that callback URLs need updating in Auth0 dashboard

The webapp already uses @mental/api as a workspace dependency. Since Vercel builds in monorepo context, this should work with turborepo/pnpm workspaces. If not, we'll add explicit transpilePackages.
  </action>
  <verify>pnpm --filter @mental/webapp build succeeds locally</verify>
  <done>Next.js config verified, env documentation updated</done>
</task>

<task type="checkpoint:human-action" gate="blocking">
  <what-needed>Deploy webapp to Vercel</what-needed>
  <instructions>
1. Go to https://vercel.com/new

2. Import the mental repository from GitHub

3. Configure the project:
   - Framework Preset: Next.js
   - Root Directory: packages/webapp
   - Build Command: pnpm build (or leave default)
   - Install Command: pnpm install

4. Add Environment Variables in Vercel dashboard:
   - AUTH0_DOMAIN: (your Auth0 domain, e.g., dev-xxx.auth0.com)
   - AUTH0_CLIENT_ID: (from Auth0 application)
   - AUTH0_CLIENT_SECRET: (from Auth0 application)
   - AUTH0_SECRET: (generate with: openssl rand -hex 32)
   - APP_BASE_URL: https://your-vercel-domain.vercel.app (will update after first deploy)

5. Deploy and note the production URL

6. After deploy, update APP_BASE_URL to match the actual Vercel URL
  </instructions>
  <resume-signal>Provide the deployed Vercel URL (e.g., "https://mental-webapp.vercel.app")</resume-signal>
</task>

<task type="checkpoint:human-action" gate="blocking">
  <what-needed>Update Auth0 application for production</what-needed>
  <instructions>
1. Go to Auth0 Dashboard > Applications > Your Application

2. Add production URLs to Allowed Callback URLs:
   - https://{vercel-url}/auth/callback
   - Keep http://localhost:3001/auth/callback for local dev

3. Add production URLs to Allowed Logout URLs:
   - https://{vercel-url}
   - Keep http://localhost:3001 for local dev

4. Add production URLs to Allowed Web Origins (if CORS needed):
   - https://{vercel-url}

5. Save changes
  </instructions>
  <resume-signal>Type "configured" when Auth0 settings are updated</resume-signal>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Production webapp deployment with Auth0 authentication</what-built>
  <how-to-verify>
1. Visit the deployed Vercel URL
2. Verify: You're redirected to Auth0 login page (route protection working)
3. Log in with your Auth0 credentials
4. Verify: Dashboard loads with your captured thoughts
5. Verify: User menu shows at bottom of sidebar
6. Click Sign out
7. Verify: You're logged out and redirected to login
8. Test on mobile device (responsive design)
  </how-to-verify>
  <resume-signal>Type "approved" if login/logout works, or describe any issues</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Webapp deployed to Vercel
- [ ] Auth0 login works on production URL
- [ ] Auth0 logout works on production URL
- [ ] Route protection redirects unauthenticated users
- [ ] Dashboard displays data correctly
- [ ] Mobile responsive design works
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- Webapp accessible at Vercel URL
- Auth0 authentication working end-to-end in production
- No console errors in browser
</success_criteria>

<output>
After completion, create `.planning/phases/19-webapp-deployment/19-01-SUMMARY.md`
</output>
