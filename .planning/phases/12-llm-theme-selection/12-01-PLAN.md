# Plan 12-01: MCP Server - Theme Enum & Remove Tags

## Overview

Refactor MCP server's `capture_thought` to:
1. Accept `theme` as an enum parameter (LLM decides)
2. Remove string-based sentiment detection
3. Remove tags parameter entirely

## Current State

```typescript
// capture_thought accepts:
{
  title: string,
  content: string,
  tags: string[],      // To be removed
  project: string
}
// + detectSentiment() for string matching
// + getAutoTags() for auto-tagging
```

## Target State

```typescript
// capture_thought accepts:
{
  title: string,
  content: string,
  project: string,
  theme: "blocker" | "concern" | "question" | "idea"  // Optional, LLM-chosen
}
// No detectSentiment(), no getAutoTags(), no tags
```

## Tasks

### Task 1: Remove detectSentiment function

**File:** `packages/mcp-server/src/index.ts`

Delete lines 10-53 (detectSentiment function).

### Task 2: Remove getAutoTags function

**File:** `packages/mcp-server/src/index.ts`

Delete lines 55-66 (getAutoTags function).

### Task 3: Update capture_thought schema

**File:** `packages/mcp-server/src/index.ts`

Replace the tool definition:

```typescript
server.tool(
  "capture_thought",
  "Capture a thought or topic to your mental database. Use this when the user mentions something they want to remember, track, or come back to later.",
  {
    title: z.string().describe("Brief title for the thought (2-10 words)"),
    content: z.string().describe("Full content or context of the thought"),
    project: z.string().optional().describe("Project or repo name for context"),
    theme: z.enum(["blocker", "concern", "question", "idea"]).optional().describe(
      "Theme/sentiment of the thought. Use: blocker (blocked, waiting on dependencies), concern (worried, risk, uncertain), question (asking how/why, unclear), idea (suggestion, alternative, maybe)"
    )
  },
  async ({ title, content, project, theme }) => {
    // Use LLM-provided theme, fall back to topic extraction
    const topicTheme = extractTheme(content);
    const finalTheme = theme || topicTheme;

    console.error(`[mental-mcp] Capturing: "${title}"`);
    console.error(`[mental-mcp] Theme: ${finalTheme || "none"}${theme ? " (LLM)" : topicTheme ? " (topic)" : ""}`);
    console.error(`[mental-mcp] Project: ${project || "none"}`);
    if (currentSessionId) {
      console.error(`[mental-mcp] Session: ${currentSessionId}`);
    }

    const client = getItemsClient();
    const res = await client.index.$post({
      json: {
        title,
        content,
        theme: finalTheme ?? undefined,
        sessionId: currentSessionId ?? undefined,
        project: project ?? undefined,
      }
    });

    // ... error handling ...

    const item = await res.json();
    console.error(`[mental-mcp] Saved with ID: ${item.id}`);

    return {
      content: [{
        type: "text",
        text: `Captured: "${title}"\nID: ${item.id}\nTheme: ${finalTheme || "none"}${theme ? " (LLM)" : topicTheme ? " (topic)" : ""}\nProject: ${project || "none"}\nStatus: open${currentSessionId ? `\nSession: ${currentSessionId}` : ""}`
      }]
    };
  }
);
```

### Task 4: Update list_thoughts display

**File:** `packages/mcp-server/src/index.ts`

Remove tags from the formatted output in list_thoughts:

```typescript
const formatted = itemList.map((item) => {
  return `- [${item.status.toUpperCase()}] ${item.title}\n  ID: ${item.id}\n  Theme: ${item.theme || "none"}\n  Created: ${item.createdAt}`;
}).join("\n\n");
```

### Task 5: Update get_thought display

**File:** `packages/mcp-server/src/index.ts`

Remove tags from type annotation and output:

```typescript
const item = await res.json() as {
  id: string;
  title: string;
  content: string;
  status: string;
  theme: string | null;
  createdAt: string;
  updatedAt: string;
  resolvedAt: string | null;
  resolution: string | null;
};

return {
  content: [{
    type: "text",
    text: `# ${item.title}

**ID:** ${item.id}
**Status:** ${item.status}
**Theme:** ${item.theme || "none"}
**Created:** ${item.createdAt}
**Updated:** ${item.updatedAt}
${item.resolvedAt ? `**Resolved:** ${item.resolvedAt}` : ""}

## Content

${item.content}

${item.resolution ? `## Resolution\n\n${item.resolution}` : ""}`
  }]
};
```

## Verification

1. Rebuild MCP server: `cd packages/mcp-server && pnpm build`
2. Restart Claude Code to reload MCP tools
3. Test capture with theme: capture a blocker thought
4. Test capture without theme: capture a general thought
5. Test list_thoughts: verify no tags in output
6. Test get_thought: verify no tags in output

## Rollback

Revert changes to `packages/mcp-server/src/index.ts`.
