---
phase: 17-npm-package
plan: 01
type: execute
depends_on: []
files_modified: [packages/mcp-server/package.json, packages/mcp-server/tsup.config.ts, packages/mcp-server/src/cli.ts, packages/mcp-server/README.md]
---

<objective>
Publish MCP server to npm as @go-mental/mcp so users can run `npx @go-mental/mcp`.

Purpose: Enable distribution of Mental MCP server to anyone who wants to capture thoughts from Claude Code/Cursor.
Output: Published npm package that users can install and run with their own API URL.
</objective>

<execution_context>
./.claude/get-shit-done/workflows/execute-plan.md
./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@packages/mcp-server/package.json
@packages/mcp-server/src/index.ts
@packages/mcp-server/src/api.ts

**Package name decided:** @go-mental/mcp
**Current state:** MCP server works locally with workspace dependencies on @mental/api (for types only - Hono RPC client)
**Challenge:** Need to bundle for npm distribution, eliminating workspace dependencies
</context>

<tasks>

<task type="auto">
  <name>Task 1: Configure tsup bundler and update package.json</name>
  <files>packages/mcp-server/package.json, packages/mcp-server/tsup.config.ts</files>
  <action>
1. Install tsup as dev dependency: `pnpm add -D tsup --filter @mental/mcp-server`

2. Create tsup.config.ts for bundling:
   - Entry: src/cli.ts (will create next)
   - Format: esm
   - Target: node18
   - Bundle all dependencies (no externals except node builtins)
   - Generate single file output
   - Shims for __dirname if needed

3. Update package.json:
   - Change name to "@go-mental/mcp"
   - Add "bin": { "go-mental-mcp": "./dist/cli.js" }
   - Add "files": ["dist", "README.md"]
   - Remove "private": true (if exists)
   - Add description: "MCP server for Mental thought capture system"
   - Add repository, license (MIT), author, keywords
   - Update build script to use tsup
   - Remove workspace dependency on @mental/api (types will be inlined by bundler)
   - Keep @modelcontextprotocol/sdk as dependency (users need it)
   - Move other dependencies to be bundled
  </action>
  <verify>pnpm install succeeds, tsup.config.ts exists</verify>
  <done>Package configured for npm publishing with tsup bundler</done>
</task>

<task type="auto">
  <name>Task 2: Create CLI entry point and inline API types</name>
  <files>packages/mcp-server/src/cli.ts, packages/mcp-server/src/api.ts</files>
  <action>
1. Create src/cli.ts:
   - Add shebang: #!/usr/bin/env node
   - Import and run the main server from index.ts
   - Handle process signals gracefully

2. Update src/api.ts to remove @mental/api type import:
   - The Hono client types can be inferred or use `any` for the RPC routes
   - Change from: `hc<ItemsRoute>` to: `hc<any>` (type safety is nice-to-have for npm package, functionality works without it)
   - Alternative: define minimal route types inline if type safety is important

3. Verify MENTAL_API_URL env var is documented (users must set this)
  </action>
  <verify>pnpm --filter @go-mental/mcp build succeeds, dist/cli.js exists with shebang</verify>
  <done>CLI entry point created, no workspace dependencies remain</done>
</task>

<task type="auto">
  <name>Task 3: Create README and test npm pack</name>
  <files>packages/mcp-server/README.md</files>
  <action>
1. Create README.md with:
   - Package description and what Mental does
   - Installation: `npm install -g @go-mental/mcp` or `npx @go-mental/mcp`
   - Configuration: MENTAL_API_URL environment variable
   - Usage with Claude Code (claude_desktop_config.json example)
   - Usage with Cursor (settings example)
   - Link to main Mental repo for more info
   - Available tools list (ping, capture_thought, list_thoughts, etc.)

2. Test packaging:
   - Run `pnpm --filter @go-mental/mcp pack`
   - Inspect tarball contents to verify only dist/ and README.md included
   - Verify no source files, node_modules, or local config leaked

3. Test locally:
   - Extract tarball to temp location
   - Run the CLI to verify it starts (will fail to connect to API, but should start)
  </action>
  <verify>`pnpm --filter @go-mental/mcp pack` creates tarball, tarball contains only expected files</verify>
  <done>README complete, package verified ready for npm publish</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `pnpm --filter @go-mental/mcp build` succeeds
- [ ] `pnpm --filter @go-mental/mcp pack` creates valid tarball
- [ ] Tarball contains only: dist/, README.md, package.json
- [ ] dist/cli.js has shebang and runs (node dist/cli.js)
- [ ] No workspace:* dependencies in published package.json
</verification>

<success_criteria>
- Package renamed to @go-mental/mcp
- tsup bundler configured and working
- CLI entry point with shebang
- README.md with installation and usage instructions
- npm pack produces clean tarball
- Ready for `npm publish`
</success_criteria>

<output>
After completion, create `.planning/phases/17-npm-package/17-01-SUMMARY.md`
</output>
