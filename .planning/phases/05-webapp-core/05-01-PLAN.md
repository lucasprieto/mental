---
phase: 05-webapp-core
plan: 01
type: execute
depends_on: []
files_modified: [packages/webapp/package.json, packages/webapp/src/app/layout.tsx, packages/webapp/src/app/page.tsx, packages/webapp/src/lib/db.ts]
---

<objective>
Set up Next.js webapp package with database connection.

Purpose: Create webapp foundation that can query the same SQLite database as the MCP server.
Output: Working Next.js app at packages/webapp with database access.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md

**From previous phases:**
- Database at @mental/db with mentalItems schema
- SQLite file at packages/mcp-server/mental.db (or MENTAL_DB_PATH)
- MentalItemRow type for items

**Tech stack decisions:**
- Next.js 14+ with App Router (standard, good DX)
- Tailwind CSS (quick styling)
- Use @mental/db package for database access

**Key constraint:**
- Webapp reads same SQLite database as MCP server
- Database path needs to be configurable
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Next.js webapp package</name>
  <files>packages/webapp/package.json, packages/webapp/tsconfig.json, packages/webapp/next.config.ts, packages/webapp/tailwind.config.ts, packages/webapp/postcss.config.mjs</files>
  <action>
Create packages/webapp directory and initialize Next.js:

```bash
cd packages
mkdir webapp
cd webapp
```

Create package.json:
```json
{
  "name": "@mental/webapp",
  "version": "1.0.0",
  "private": true,
  "scripts": {
    "dev": "next dev --port 3001",
    "build": "next build",
    "start": "next start --port 3001"
  },
  "dependencies": {
    "next": "^15.0.0",
    "react": "^19.0.0",
    "react-dom": "^19.0.0",
    "@mental/db": "workspace:*"
  },
  "devDependencies": {
    "@types/react": "^19.0.0",
    "@types/react-dom": "^19.0.0",
    "typescript": "^5.3.0",
    "tailwindcss": "^3.4.0",
    "postcss": "^8.4.0",
    "autoprefixer": "^10.4.0"
  }
}
```

Create tsconfig.json:
```json
{
  "compilerOptions": {
    "target": "ES2022",
    "lib": ["dom", "dom.iterable", "ES2022"],
    "allowJs": true,
    "skipLibCheck": true,
    "strict": true,
    "noEmit": true,
    "esModuleInterop": true,
    "module": "esnext",
    "moduleResolution": "bundler",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "jsx": "preserve",
    "incremental": true,
    "plugins": [{ "name": "next" }],
    "paths": { "@/*": ["./src/*"] }
  },
  "include": ["next-env.d.ts", "**/*.ts", "**/*.tsx", ".next/types/**/*.ts"],
  "exclude": ["node_modules"]
}
```

Create next.config.ts:
```typescript
import type { NextConfig } from "next";

const nextConfig: NextConfig = {
  // Enable server components to use @mental/db
  serverExternalPackages: ["better-sqlite3"],
};

export default nextConfig;
```

Create tailwind.config.ts:
```typescript
import type { Config } from "tailwindcss";

const config: Config = {
  content: ["./src/**/*.{js,ts,jsx,tsx,mdx}"],
  theme: { extend: {} },
  plugins: [],
};

export default config;
```

Create postcss.config.mjs:
```javascript
const config = {
  plugins: {
    tailwindcss: {},
    autoprefixer: {},
  },
};

export default config;
```
  </action>
  <verify>Files exist and pnpm install succeeds from root</verify>
  <done>Next.js package created with proper configuration</done>
</task>

<task type="auto">
  <name>Task 2: Create app shell with database connection</name>
  <files>packages/webapp/src/app/layout.tsx, packages/webapp/src/app/page.tsx, packages/webapp/src/app/globals.css, packages/webapp/src/lib/db.ts</files>
  <action>
Create src/lib/db.ts for database access:
```typescript
import { getDb, type DbClient } from "@mental/db";
import path from "path";

// Use same database as MCP server
// Default: packages/mcp-server/mental.db (relative to monorepo root)
const DB_PATH = process.env.MENTAL_DB_PATH ||
  path.join(process.cwd(), "..", "mcp-server", "mental.db");

let db: DbClient | null = null;

export function getDatabase(): DbClient {
  if (!db) {
    db = getDb(DB_PATH);
  }
  return db;
}
```

Create src/app/globals.css:
```css
@tailwind base;
@tailwind components;
@tailwind utilities;

body {
  @apply bg-gray-50 text-gray-900;
}
```

Create src/app/layout.tsx:
```typescript
import type { Metadata } from "next";
import "./globals.css";

export const metadata: Metadata = {
  title: "Mental - Mind Centralization",
  description: "Track your thoughts, never lose context",
};

export default function RootLayout({
  children,
}: {
  children: React.ReactNode;
}) {
  return (
    <html lang="en">
      <body className="min-h-screen">
        <header className="bg-white border-b border-gray-200 px-6 py-4">
          <h1 className="text-xl font-semibold">Mental</h1>
        </header>
        <main className="container mx-auto px-6 py-8">
          {children}
        </main>
      </body>
    </html>
  );
}
```

Create src/app/page.tsx (simple placeholder):
```typescript
export default function Home() {
  return (
    <div>
      <h2 className="text-2xl font-bold mb-4">Dashboard</h2>
      <p className="text-gray-600">Coming in 05-02...</p>
    </div>
  );
}
```

Create next-env.d.ts:
```typescript
/// <reference types="next" />
/// <reference types="next/image-types/global" />
```
  </action>
  <verify>pnpm install && pnpm --filter @mental/webapp dev starts without errors</verify>
  <done>App shell renders with Tailwind styling</done>
</task>

<task type="auto">
  <name>Task 3: Verify database connection works</name>
  <files>packages/webapp/src/app/page.tsx</files>
  <action>
Update src/app/page.tsx to test database connection:

```typescript
import { getDatabase } from "@/lib/db";
import { mentalItems, desc } from "@mental/db";

export const dynamic = "force-dynamic"; // Don't cache this page

export default async function Home() {
  const db = getDatabase();

  // Get counts for verification
  const allItems = await db.select().from(mentalItems);
  const openItems = allItems.filter(item => item.status === "open");
  const resolvedItems = allItems.filter(item => item.status === "resolved");

  return (
    <div>
      <h2 className="text-2xl font-bold mb-4">Dashboard</h2>

      <div className="grid grid-cols-3 gap-4 mb-8">
        <div className="bg-white p-4 rounded-lg shadow">
          <p className="text-3xl font-bold">{allItems.length}</p>
          <p className="text-gray-600">Total Items</p>
        </div>
        <div className="bg-white p-4 rounded-lg shadow">
          <p className="text-3xl font-bold text-blue-600">{openItems.length}</p>
          <p className="text-gray-600">Open</p>
        </div>
        <div className="bg-white p-4 rounded-lg shadow">
          <p className="text-3xl font-bold text-green-600">{resolvedItems.length}</p>
          <p className="text-gray-600">Resolved</p>
        </div>
      </div>

      <p className="text-gray-500 text-sm">
        Database connected successfully. Full dashboard coming in 05-02.
      </p>
    </div>
  );
}
```

Run verification:
1. pnpm install (from root)
2. pnpm --filter @mental/webapp dev
3. Visit http://localhost:3001
4. Should see counts from database
  </action>
  <verify>pnpm --filter @mental/webapp build succeeds; dev server shows database counts</verify>
  <done>Webapp connects to SQLite database and displays item counts</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] pnpm install succeeds from root
- [ ] pnpm --filter @mental/webapp build succeeds
- [ ] pnpm --filter @mental/webapp dev starts on port 3001
- [ ] http://localhost:3001 shows dashboard with database counts
- [ ] Tailwind CSS styling works
</verification>

<success_criteria>
- Next.js webapp package created at packages/webapp
- Uses @mental/db workspace package for database
- Connects to same SQLite database as MCP server
- Basic shell with header and dashboard placeholder
- Ready for 05-02 dashboard implementation
</success_criteria>

<output>
After completion, create `.planning/phases/05-webapp-core/05-01-SUMMARY.md`
</output>
