---
phase: 13-dashboard-redesign
plan: 02
type: execute
depends_on: ["13-01"]
files_modified: [packages/webapp/src/components/CollapsibleSection.tsx, packages/webapp/src/app/page.tsx]
---

<objective>
Add collapsible "Recently Resolved" section using Headless UI Disclosure.

Purpose: Complete dashboard redesign by making Recently Resolved section collapsible (collapsed by default) for cleaner focus on open items.
Output: Recently Resolved section uses accessible collapsible with smooth animation, collapsed by default.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/13-dashboard-redesign/13-CONTEXT.md
@.planning/phases/13-dashboard-redesign/13-RESEARCH.md
@.planning/phases/13-dashboard-redesign/13-01-SUMMARY.md

**From RESEARCH.md - Don't hand-roll:**
- Use Headless UI Disclosure for collapsible (not custom useState)
- Use Headless UI Transition for animation (not CSS height animation)

**From CONTEXT.md:**
- Recently resolved section collapsible, collapsed by default
- Linear-style minimal aesthetic with subtle hover states
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create CollapsibleSection component</name>
  <files>packages/webapp/src/components/CollapsibleSection.tsx</files>
  <action>
Create reusable CollapsibleSection component using Headless UI Disclosure:

```tsx
"use client";

import { Disclosure, DisclosureButton, DisclosurePanel, Transition } from '@headlessui/react'

interface CollapsibleSectionProps {
  title: string;
  count?: number;
  defaultOpen?: boolean;
  children: React.ReactNode;
}

export function CollapsibleSection({ title, count, defaultOpen = false, children }: CollapsibleSectionProps) {
  return (
    <Disclosure defaultOpen={defaultOpen}>
      {({ open }) => (
        <section className="mb-8">
          <DisclosureButton className="flex w-full items-center justify-between py-2 text-left group">
            <h3 className="text-lg font-semibold text-gray-800">
              {title}
              {count !== undefined && (
                <span className="ml-2 text-sm font-normal text-gray-500">({count})</span>
              )}
            </h3>
            <svg
              className={`w-5 h-5 text-gray-500 transition-transform duration-200 ${open ? 'rotate-180' : ''}`}
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 9l-7 7-7-7" />
            </svg>
          </DisclosureButton>
          <Transition
            enter="transition duration-100 ease-out"
            enterFrom="opacity-0"
            enterTo="opacity-100"
            leave="transition duration-75 ease-out"
            leaveFrom="opacity-100"
            leaveTo="opacity-0"
          >
            <DisclosurePanel>
              {children}
            </DisclosurePanel>
          </Transition>
        </section>
      )}
    </Disclosure>
  )
}
```

Key points:
- Uses Headless UI for accessibility (aria-expanded handled automatically)
- Chevron rotates on open/close
- Smooth opacity transition (avoid height animation per RESEARCH.md)
- Optional count display next to title
- defaultOpen prop for flexibility (will be false for Recently Resolved)
  </action>
  <verify>Component file created with no TypeScript errors.</verify>
  <done>CollapsibleSection component created using Headless UI Disclosure with accessible markup and transitions.</done>
</task>

<task type="auto">
  <name>Task 2: Apply CollapsibleSection to Recently Resolved</name>
  <files>packages/webapp/src/app/page.tsx</files>
  <action>
1. Import CollapsibleSection in page.tsx

2. Wrap the "Recently Resolved" ItemList in CollapsibleSection:
   - title="Recently Resolved"
   - count={filteredResolvedItems.length}
   - defaultOpen={false} (collapsed by default per CONTEXT.md)

3. Keep "Open Items" as regular section (not collapsible) - it should always be visible

4. Ensure the section only renders when there are resolved items OR when showing resolved filter

Before:
```tsx
{(statusFilter === "all" || statusFilter === "resolved") && (
  <ItemList
    title="Recently Resolved"
    items={filteredResolvedItems}
    ...
  />
)}
```

After:
```tsx
{(statusFilter === "all" || statusFilter === "resolved") && filteredResolvedItems.length > 0 && (
  <CollapsibleSection
    title="Recently Resolved"
    count={filteredResolvedItems.length}
    defaultOpen={false}
  >
    <div className="grid gap-4 md:grid-cols-2 lg:grid-cols-3">
      {filteredResolvedItems.map(item => (
        <ItemCard key={item.id} item={item} />
      ))}
    </div>
  </CollapsibleSection>
)}
```

Note: We render the grid directly inside CollapsibleSection since ItemList includes its own title which we're replacing with the collapsible header.
  </action>
  <verify>pnpm run build --filter @mental/webapp succeeds. Dev server shows Recently Resolved collapsed by default, expands on click.</verify>
  <done>Recently Resolved section is collapsible, collapsed by default, uses accessible Headless UI Disclosure.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Dashboard redesign with sidebar filters and collapsible Recently Resolved section</what-built>
  <how-to-verify>
    1. Run: pnpm run dev --filter @mental/webapp
    2. Visit: http://localhost:3001
    3. Verify sidebar:
       - Fixed on left side (w-64)
       - "Mental" branding at top
       - Slim theme pills below branding
       - Status filters (All/Open/Resolved)
       - Theme filters
       - Linear-style minimal aesthetic
    4. Verify main content:
       - Stats row at top
       - Open items grid
       - Recently Resolved collapsed by default
    5. Test interactions:
       - Click status filters → items filter correctly
       - Click theme filters → items filter correctly
       - Click Recently Resolved header → expands/collapses smoothly
       - Chevron rotates on expand/collapse
    6. Verify no visual issues:
       - No content behind sidebar
       - No horizontal scrollbar
       - Clean, calm, focused appearance
  </how-to-verify>
  <resume-signal>Type "approved" to complete phase, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `pnpm run build` succeeds for webapp
- [ ] CollapsibleSection uses Headless UI Disclosure
- [ ] Recently Resolved is collapsed by default
- [ ] Expand/collapse works with smooth animation
- [ ] Accessibility: aria-expanded updates correctly
- [ ] Human verification approved
</verification>

<success_criteria>
- CollapsibleSection component created with Headless UI
- Recently Resolved uses CollapsibleSection, collapsed by default
- Dashboard has Linear-style minimal aesthetic
- All filters work correctly
- Phase 13 complete
</success_criteria>

<output>
After completion, create `.planning/phases/13-dashboard-redesign/13-02-SUMMARY.md`
</output>
